<!DOCTYPE html>
<html>
<head>
<title>A Game of Snake Clone</title>
  <style>
    #button {
      font-size: 3em;
    }
    #canvascontainer {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    #startscreen{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
  </style>
</head>

<body>

<div id="startscreen">
  <img id="titleimage" src="https://cdn-icons.flaticon.com/png/512/3975/premium/3975426.png?token=exp=1633699285~hmac=0a80efb5de5621c5a7e5daf91429c882">
    <div id="button">
      <button id="easy" onclick="timeout = 300; easy = true; startGame()">easy</button>
      <button id="medium" onclick="timeout = 200; medium = true; startGame()">medium</button>
      <button id="hard" onclick="timeout = 150; hard = true; startGame()">hard Hell Yeah!!!</button>
    </div>
</div>
<div id="canvascontainer">
</div>
  <script>

    // for debugging
    let LIMIT = 500;
    let run_count=0;
    let interval_id;

    let starting_x = 300;
    let starting_y = 300;
    let step = 10;
    let direction;
    let apple_position_x;
    let apple_position_y;
    let size = 1;
    let snake = new Array();
    let timeout;
    let easy = false;
    let medium = false;
    let hard = false;

    let startscreen = document.getElementById("startscreen");
    let gamescreen;
    let gamescreen_height;
    let gamescreen_width;
    let ctx;

    let SEGMENT_WIDTH = 10;
    let SEGMENT_HEIGHT = 10;
    
    
    function has_Game_Ended() {
      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
      }
      const hitLeftWall = starting_x < 0;
      const hitRightWall = starting_x > gamescreen_width - 10;
      const hitToptWall = starting_y < 0;
      const hitBottomWall = starting_y > gamescreen_height - 10;
      return hitLeftWall || hitRightWall || hitToptWall || hitBottomWall;
    }
    
    function gameOver() {
      clearInterval(interval_id);
      document.location.reload();
      alert ('You is dead! Size: ' + size);
      }
    
    function adjustSpeedBySize(){
      if (easy === true) {
        switch (size) {
          case 50:
            timeout = 280;
            return timeout;
          case 100:
            timeout = 260;
            return timeout;
          case 150:
            timeout = 240;
            return timeout;
          case 200:
            timeout = 220;
            return timeout;
          case 250:
            timeout = 200;
            return timeout;
        }
        
      } else if (medium === true) {
        switch (size) {
          case 50:
            timeout = 180;
            return timeout;
          case 100:
            timeout = 160;
            return timeout;
          case 150:
            timeout = 140;
            return timeout;
          case 200:
            timeout = 120;
            return timeout;
          case 250:
            timeout = 100;
            return timeout;
        }
        
      } else if (hard === true) {
        switch (size) {
          case 50:
            timeout = 130;
            return timeout;
          case 100:
            timeout = 110;
            return timeout;
          case 150:
            timeout = 90;
            return timeout;
          case 200:
            timeout = 70;
            return timeout;
          case 250:
            timeout = 50;
            return timeout;
        }
      }
    } 
    
    function isAppleEaten() {
      if (starting_x === apple_position_x && starting_y === apple_position_y) {
        return true;
      }
      return false;
    }

    function moveSnake() {
      snake.forEach(function(segment) {
          rect(segment.x,segment.y,SEGMENT_WIDTH,SEGMENT_HEIGHT);
        });

      if(isAppleEaten()) {
          size++;
          init_apple();
          adjustSpeedBySize();
      } else {
        snake.pop();
      }
    }

    function init_apple() {
      apple_position_x = getRandomInt(0,gamescreen_width);
      apple_position_y = getRandomInt(0,gamescreen_height);
    }

    function checkDirection() {
        switch(direction) {
          case 'left':
            starting_x -= step;
            break;
          case 'up':
            starting_y -= step;
            break;
          case 'right':
            starting_x += step;
            break;
          case 'down':
            starting_y += step;
            break;
          default:
            direction = 'up';
            starting_y -= step;
        }
    }

    function onKeyDown(evt) {
      switch(evt.keyCode) {
        // left
        case 37:
          if(direction === 'right') break;
          direction = 'left';
          break;
        // up
        case 38:
          if(direction === 'down') break;
          direction = 'up';
          break;
        // right
        case 39:
          if(direction === 'left') return;
          direction = 'right';
          break;
        // down
        case 40:
          if(direction === 'up') break;
          direction = 'down';
          break;
      }
    }

    function clear() {
      ctx.clearRect(0,0,gamescreen_width,gamescreen_height);
    }

    function rect(x,y,width,height) {
      ctx.beginPath();
      ctx.rect(x,y,width,height);
      ctx.closePath();
      ctx.fill();
    }

    function draw() {
      if (has_Game_Ended()) {
        gameOver();
      }
      
      setTimeout(function onTick() {
        document.addEventListener('keydown', onKeyDown);
        run_count++;
        if (LIMIT !== 0 && run_count > LIMIT) {
          clearInterval(interval_id);
        }
        
        checkDirection()
        snake.unshift({'x': starting_x, 'y': starting_y});
        clear();
        moveSnake();
        rect(apple_position_x, apple_position_y, SEGMENT_WIDTH, SEGMENT_HEIGHT);
        draw();
      }, timeout)
    }
    
    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(((Math.random() * (max - min +1)) + min)/10)*10;
    }

    function loadCanvas() {
      let canvas = document.createElement("canvas");
      div = document.getElementById("canvascontainer");
      canvas.id = "gamescreen";
      canvas.width = 600;
      canvas.height = 600;
      canvas.style.border = "1px solid";
      div.appendChild(canvas);
    }
    
    function startGame () {
      startscreen.remove();
      loadCanvas();
      gamescreen = document.getElementById("gamescreen");
      gamescreen_height = gamescreen.height;
      gamescreen_width = gamescreen.width;
      ctx = gamescreen.getContext("2d");
      init_apple();
      draw();
    }
    
  </script>
</body>

</html>
