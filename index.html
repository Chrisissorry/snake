<!DOCTYPE html>
<html>
<head>
<title>A Game of Snake Clone</title>
  <style>
    #button {
      font-size: 3em;
    }
    #canvascontainer {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    #startscreen{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
  </style>
</head>

<body>

<div id="startscreen">
  <img id="titleimage" src="https://cdn-icons.flaticon.com/png/512/3975/premium/3975426.png?token=exp=1633699285~hmac=0a80efb5de5621c5a7e5daf91429c882">
    <div id="button">
      <button onclick="easy()">easy</button>
      <button onclick="medium()">medium</button>
      <button onclick="hard()">hard Hell Yeah!!!</button>
    </div>
</div>
<div id="canvascontainer">
</div>
  <script>

    // for debugging
    var LIMIT = 500;
    var run_count=0;
    var interval_id;

    var starting_x = 300;
    var starting_y = 300;
    var step = 10;
    var direction;
    var apple_position_x;
    var apple_position_y;
    var size = 1;
    var snake = new Array();
    var speed;

    var startscreen = document.getElementById("startscreen");
    var gamescreen;
    var gamescreen_height;
    var gamescreen_width;
    var ctx;

    var SEGMENT_WIDTH = 10;
    var SEGMENT_HEIGHT = 10;
    
    
    function has_game_ended() {
      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
      }
      const hitLeftWall = starting_x < 0;
      const hitRightWall = starting_x > gamescreen_width - 10;
      const hitToptWall = starting_y < 0;
      const hitBottomWall = starting_y > gamescreen_height - 10;
      return hitLeftWall || hitRightWall || hitToptWall || hitBottomWall;
    }
    
    function gameOver() {
      clearInterval(interval_id);
      document.location.reload();
      alert ('You is dead! Size: ' + size);
      }
    
    function getSpeed(){
      if (size === 50) {
        speed = speed - 30;
      } else if (size === 100) {
        speed = speed - 20;
      } else if (size === 150) {
        speed = speed - 20;
      } else if (size === 200) {
        speed = speed - 20;
      } else if (size === 300) {
        speed = speed - 10;
      } 
    }
    
    function isAppleEaten() {
      if (starting_x === apple_position_x && starting_y === apple_position_y) {
        return true;
      }
      return false;
    }

    function moveSnake() {
      snake.forEach(function(segment) {
          rect(segment.x,segment.y,SEGMENT_WIDTH,SEGMENT_HEIGHT);
        });

      if(isAppleEaten()) {
          size++;
          init_apple();
          getSpeed();
      } else {
        snake.pop();
      }
    }

    function init_apple() {
      apple_position_x = getRandomInt(0,gamescreen_width);
      apple_position_y = getRandomInt(0,gamescreen_height);
    }

    function checkDirection() {
        switch(direction) {
          case 'left':
            starting_x -= step;
            break;
          case 'up':
            starting_y -= step;
            break;
          case 'right':
            starting_x += step;
            break;
          case 'down':
            starting_y += step;
            break;
          default:
            direction = 'up';
            starting_y -= step;
        }
    }

    function onKeyDown(evt) {
      switch(evt.keyCode) {
        // left
        case 37:
          if(direction === 'right') break;
          direction = 'left';
          break;
        // up
        case 38:
          if(direction === 'down') break;
          direction = 'up';
          break;
        // right
        case 39:
          if(direction === 'left') return;
          direction = 'right';
          break;
        // down
        case 40:
          if(direction === 'up') break;
          direction = 'down';
          break;
      }
    }

    function clear() {
      ctx.clearRect(0,0,gamescreen_width,gamescreen_height);
    }

    function rect(x,y,width,height) {
      ctx.beginPath();
      ctx.rect(x,y,width,height);
      ctx.closePath();
      ctx.fill();
    }

    function draw() {
      if (has_game_ended()) {
        gameOver();
      }
      setTimeout(function onTick() {
        document.addEventListener('keydown', onKeyDown);
        run_count++;
        if (LIMIT !== 0 && run_count > LIMIT) {
          clearInterval(interval_id);
        }
        checkDirection()
        snake.unshift({'x': starting_x, 'y': starting_y});
        clear();
        moveSnake();
        rect(apple_position_x, apple_position_y, SEGMENT_WIDTH, SEGMENT_HEIGHT);
        draw();
      }, speed)
    }
    
    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(((Math.random() * (max - min +1)) + min)/10)*10;
    }

    function loadCanvas() {
      var canvas = document.createElement("canvas");
      div = document.getElementById("canvascontainer");
      canvas.id = "gamescreen";
      canvas.width = 600;
      canvas.height = 600;
      canvas.style.border = "1px solid";
      div.appendChild(canvas);
    }
    
    function easy(){
      startscreen.remove();
      loadCanvas();
      speed = 300;
      gamescreen = document.getElementById("gamescreen");
      gamescreen_height = gamescreen.height;
      gamescreen_width = gamescreen.width;
      ctx = gamescreen.getContext("2d");
      init_apple();
      draw();
    }

    function medium(){
      startscreen.remove();
      loadCanvas();
      speed = 200;
      gamescreen = document.getElementById("gamescreen");
      gamescreen_height = gamescreen.height;
      gamescreen_width = gamescreen.width;
      ctx = gamescreen.getContext("2d");
      init_apple();
      draw();
    }

    function hard(){
      startscreen.remove();
      loadCanvas();
      speed = 150;
      gamescreen = document.getElementById("gamescreen");
      gamescreen_height = gamescreen.height;
      gamescreen_width = gamescreen.width;
      ctx = gamescreen.getContext("2d");
      init_apple();
      draw();
    }
            
  </script>
</body>

</html>
