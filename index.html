<!DOCTYPE html>
<html>
<head>
<title>A Game of Snake Clone</title>
  <style>
    #gamescreen {
      border: 1px solid black;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      visibility: hidden;
    }
    #button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>

<body>
<div id="button">
  <button onclick="easy()">easy</button>
  <button onclick="medium()">medium</button>
  <button onclick="hard()">hard Hell Yeah!!!</button>
</div>
  <canvas id="gamescreen" width="600" height="600"></canvas>
  <script>

    // for debugging
    var LIMIT = 500;
    var run_count=0;
    var interval_id;

    var x = 300;
    var y = 300;
    var step = 10;
    var direction;
    var apple_position_x;
    var apple_position_y;
    var size = 1;
    var snake = new Array();
    var speed;
    
    var gamescreen = document.getElementById('gamescreen');
    var gamescreen_height = gamescreen.height;
    var gamescreen_width = gamescreen.width;
    var ctx = gamescreen.getContext('2d');

    var SEGMENT_WIDTH = 10;
    var SEGMENT_HEIGHT = 10;
    

    function has_game_ended() {
      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
      }
      const hitLeftWall = x < 0;
      const hitRightWall = x > gamescreen_width - 10;
      const hitToptWall = y < 0;
      const hitBottomWall = y > gamescreen_height - 10;
      return hitLeftWall || hitRightWall || hitToptWall || hitBottomWall;
    }
    
    function gameOver() {
      clearInterval(interval_id);
      document.location.reload();
      alert ('You is dead! Size: ' + size);
      }
    
    function getSpeed(){
      console.log(speed);
      console.log(size);
      if (size === 50) {
        speed = speed - 30;
      } else if (size === 100) {
        speed = speed - 20;
      } else if (size === 150) {
        speed = speed - 20;
      } else if (size === 200) {
        speed = speed - 20;
      } else if (size === 300) {
        speed = speed - 10;
      } 
    }
    
    function isAppleEaten() {
      if (x === apple_position_x && y === apple_position_y) {
        return true;
      }
      return false;
    }

    function moveSnake() {
      snake.forEach(function(segment) {
          rect(segment.x,segment.y,SEGMENT_WIDTH,SEGMENT_HEIGHT);
        });

      if(isAppleEaten()) {
          size++;
          init_apple();
          getSpeed();
      } else {
        snake.pop();
      }
    }

    function init_apple() {
      apple_position_x = getRandomInt(0,gamescreen_width);
      apple_position_y = getRandomInt(0,gamescreen_height);
    }

    function checkDirection() {
        switch(direction) {
          case 'left':
            x -= step;
            break;
          case 'up':
            y -= step;
            break;
          case 'right':
            x += step;
            break;
          case 'down':
            y += step;
            break;
          default:
            direction = 'up';
            y -= step;
        }
    }

    function onKeyDown(evt) {
      switch(evt.keyCode) {
        // left
        case 37:
          if(direction === 'right') break;
          direction = 'left';
          break;
        // up
        case 38:
          if(direction === 'down') break;
          direction = 'up';
          break;
        // right
        case 39:
          if(direction === 'left') return;
          direction = 'right';
          break;
        // down
        case 40:
          if(direction === 'up') break;
          direction = 'down';
          break;
      }
    }

    function clear() {
      ctx.clearRect(0,0,gamescreen_width,gamescreen_height);
    }

    function rect(x,y,width,height) {
      ctx.beginPath();
      ctx.rect(x,y,width,height);
      ctx.closePath();
      ctx.fill();
    }

    function draw() {
      if (has_game_ended()) {
        gameOver();
      }
      setTimeout(function onTick() {
        document.addEventListener('keydown', onKeyDown);
        run_count++;
        if (LIMIT !== 0 && run_count > LIMIT) {
          clearInterval(interval_id);
        }
        checkDirection()
        snake.unshift({'x': x, 'y': y});
        clear();
        moveSnake();
        rect(apple_position_x, apple_position_y, SEGMENT_WIDTH, SEGMENT_HEIGHT);
        draw();
      }, speed)
    }
    
    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(((Math.random() * (max - min +1)) + min)/10)*10;
    }

    function init() {
      init_apple();
    }
    
    function easy(){
      speed = 300;
      init();
      draw();
      document.getElementById("button").style.visibility = "hidden";
      document.getElementById("gamescreen").style.visibility = "visible";
    }

    function medium(){
      speed = 200;
      init();
      draw();
      document.getElementById("button").style.visibility = "hidden";
      document.getElementById("gamescreen").style.visibility = "visible";
    }

    function hard(){
      speed = 150;
      init();
      draw();
      document.getElementById("button").style.visibility = "hidden";
      document.getElementById("gamescreen").style.visibility = "visible";
    }
    
  </script>
</body>

</html>
